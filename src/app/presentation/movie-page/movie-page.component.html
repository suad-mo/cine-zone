<div class="page-container">
  <!-- Global Loading Indicator -->
  @if (state.loadingStates.modes() || state.loadingStates.locations()) {
  <div class="global-loading">
    <app-loading-spinner size="large" />
  </div>
  }

  <!-- Error Messages -->
  @if (state.errors.modes()) {
  <app-error-message [error]="state.errors.modes()" />
  } @if (state.errors.locations()) {
  <app-error-message [error]="state.errors.locations()" />
  }

  <!-- Filters Section -->
  <div class="filters-container">
    <div class="filter-group">
      <app-mode-select
        [modes]="state.modes()"
        [selectedId]="state.selectedMode()?.id ?? null"
        [disabled]="!!state.errors.modes()"
        (selectedChange)="state.selectedMode.set($event)"
      />

      @if (state.errors.modes()) {
      <button class="refresh-button" (click)="state.refreshModes()">
        Retry
      </button>
      }
    </div>

    <div class="filter-group">
      <app-location-select
        [locations]="state.locations()"
        [selectedId]="
          state.selectedLocation() && state.selectedLocation()?.id != null
            ? state.selectedLocation()!.id.toString()
            : null
        "
        [disabled]="!!state.errors.locations()"
        (selectedChange)="state.selectedLocation.set($event)"
      />

      @if (state.errors.locations()) {
      <button class="refresh-button" (click)="state.refreshLocations()">
        Retry
      </button>
      }
    </div>

    <div class="filter-group">
      <app-day-select
        [days]="state.days()"
        [selectedDate]="state.selectedDay()"
        [disabled]="!!state.errors.days() || state.loadingStates.days()"
        (selectedChange)="state.selectedDay.set($event)"
      />

      @if (state.loadingStates.days()) {
      <app-loading-spinner size="small" />
      } @if (state.errors.days()) {
      <span class="error-text">Failed to load days</span>
      }
    </div>
  </div>

  <!-- Movies Grid -->
  <div class="content-container">
    @if (state.loadingStates.movies()) {
    <div class="movies-loading">
      <app-loading-spinner size="medium" />
    </div>
    } @if (state.errors.movies()) {
    <app-error-message [error]="state.errors.movies()" />
    }

    <app-movie-grid
      [movies]="state.movies()"
      [emptyMessage]="getEmptyMessage()"
    />
  </div>
</div>
